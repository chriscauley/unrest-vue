var t=Object.defineProperty,e=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(e,o,s)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s;import{createPopper as l}from"@popperjs/core";import{openBlock as a,createBlock as n,renderSlot as i,resolveComponent as c,createVNode as d,toDisplayString as m,withCtx as u,Fragment as p,renderList as h,resolveDynamicComponent as f,mergeProps as v,createCommentVNode as g,createTextVNode as y,reactive as k}from"vue";import{ReactiveRestApi as b}from"@unrest/vue-reactive-storage";var _={data:()=>({focused:!1}),methods:{onFocus(){},onBlur(){},toggleFocus(t){t.__dropdown_touched!==this&&(t.__dropdown_touched=t.__dropdown_touched||this,this.focused?(document.removeEventListener("click",this.toggleFocus),this.onFocus()):t.shiftKey||t.ctrlKey||(document.addEventListener("click",this.toggleFocus),this.onBlur()),this.focused=!this.focused)}}};const w={props:{target:Object,placement:String,offset:[Array,String]},data:()=>({popper:null}),watch:{target:"reset"},mounted(){this.reset()},unmount(){this.popper.destroy()},methods:{reset(){var t;null==(t=this.popper)||t.destroy();const e=[],o="string"==typeof this.offset?this.offset.split(",").map(Number):this.offset;o&&e.push({name:"offset",options:{offset:o}});const{placement:s="bottom-start",target:r=this.$el.parentElement}=this;this.popper=l(r,this.$el,{placement:s,modifiers:e})}}},C={class:"ur-popper"};w.render=function(t,e,o,s,r,l){return a(),n("div",C,[i(t.$slots,"default")])};const $=t=>{"string"==typeof t&&(t={text:t,to:t});const e=t.attrs=t.attrs||{};return e.class=e.class||[],Array.isArray(e.class)||(e.class=[e.class]),t.class&&e.class.push(t.class),t.tagName=t.tagName||"div",t.to&&(e.to=t.to,t.tagName="router-link"),t.href&&(e.href=t.href,t.tagName="a"),t.click&&(e.onclick=t.click,e.class.push("cursor-pointer")),t.key=t.key||t.text||t.icon,t},x={components:{UrPopper:w},mixins:[_],props:{items:Array,placement:String,title:String},computed:{preppedItems(){return this.items.map($)}}},A={class:"ur-dropdown__trigger"},O={key:0,class:"dropdown-items"};x.render=function(t,e,o,s,r,l){const k=c("ur-popper");return a(),n("div",{onClick:e[1]||(e[1]=(...e)=>t.toggleFocus&&t.toggleFocus(...e)),class:"ur-dropdown"},[i(t.$slots,"default",{},(()=>[d("div",A,m(o.title),1)])),t.focused?(a(),n(k,{key:0,class:"popdown",placement:o.placement},{default:u((()=>[i(t.$slots,"content",{},(()=>{var t;return[(null==(t=o.items)?void 0:t.length)?(a(),n("div",O,[(a(!0),n(p,null,h(l.preppedItems,(t=>(a(),n(f(t.tagName),v({class:"dropdown-item"},t.attrs,{key:t.key}),{default:u((()=>[t.icon?(a(),n("i",{key:0,class:`fa fa-${t.icon}`},null,2)):g("",!0),y(" "+m(t.text),1)])),_:2},1040)))),128))])):g("",!0)]}))])),_:3},8,["placement"])):g("",!0)])};const S={props:{close:Function,title:String}},j={class:"modal"},E={class:"modal-content"},F={key:0,class:"modal-header"},N={key:0,class:"modal-title"},D={class:"modal-body"},P={class:"modal-footer"};S.render=function(t,e,o,s,r,l){return a(),n("div",j,[d("div",{class:"modal-mask",onClick:e[1]||(e[1]=(...t)=>o.close&&o.close(...t))}),d("div",E,[o.title?(a(),n("div",F,[o.title?(a(),n("div",N,m(o.title),1)):g("",!0)])):g("",!0),d("div",D,[i(t.$slots,"default")]),d("div",P,[i(t.$slots,"actions",{},(()=>[d("button",{class:"btn -secondary",onClick:e[2]||(e[2]=(...t)=>o.close&&o.close(...t))},"Close")]))])])])};const U=b(),L=t=>{const e={};return Object.keys(t).forEach((o=>{"object"==typeof t[o]&&Object.keys(t[o]).length?e[o]=L(t[o]):e[o]=t[o]})),Object.assign({},e)},I={props:{form_name:String,success:Function,onDelete:Function},data:()=>({errors:null,loading:!1,confirming_delete:!1}),computed:{name(){var t;return null==(t=this.schema)?void 0:t.properties.name.default},schema(){const t=(e=this.form_name,null==(o=U.get(`${e}/?schema=1`))?void 0:o.schema);var e,o;return t&&(t=>((t=L(t)).properties.avatar_url&&(t.properties.avatar_url.type="image",t.properties.avatar_url.title="Avatar"),t.properties.photo_url&&(t.properties.photo_url.type="image",t.properties.photo_url.title="Photo"),Object.values(t.properties).forEach((t=>{"HiddenInput"===t.__widget&&(t.ui={tagName:"ur-hidden"})})),t))(t)}},methods:{submit(t){if(!this.loading)return this.errors=null,this.loading=!0,U.post(`${this.form_name}/`,t).catch((t=>{throw this.loading=!1,t})).then((t=>{var e;this.loading=!1,U.markStale(),null==(e=this.success)||e.call(this,t)}))},doDelete(){U.delete(`${this.form_name}/`).then((()=>{this.onDelete(this.name)}))}}},T=d("button",{type:"submit",class:"btn -primary"},"Submit",-1),M={key:1},B=d("p",null,"Are you sure you want to delete this? This cannot be undone",-1),K={class:"ur-form__actions"},V={key:2,class:"ur-placeholder"};I.render=function(t,e,o,s,r,l){const i=c("unrest-form");return l.schema&&!r.confirming_delete?(a(),n(i,v({key:0,schema:l.schema},t.$attrs,{onSubmit:l.submit,errors:r.errors}),{actions:u((()=>[T,o.onDelete?(a(),n("div",{key:0,class:"btn -danger",onClick:e[1]||(e[1]=t=>r.confirming_delete=!0)},"Delete")):g("",!0)])),_:1},16,["schema","onSubmit","errors"])):r.confirming_delete?(a(),n("div",M,[d("h3",null,'Delete "'+m(l.name)+'"',1),B,d("div",K,[d("button",{class:"btn -primary",onClick:e[2]||(e[2]=(...t)=>l.doDelete&&l.doDelete(...t))},"Yes, Delete It"),d("button",{class:"btn -secondary",onClick:e[3]||(e[3]=t=>r.confirming_delete=!1)},"No")])])):(a(),n("div",V))};const q=["success","error","info","warn","todo"],H=k({toasts:[],alert:null,confirm:null}),Y=({id:t})=>{H.toasts[t]&&(H.toasts[t].hidden=!0)},Z=({text:t,level:e,delay:o=1e4})=>{const s=H.toasts.length;H.toasts.push({id:s,text:t,level:e}),o&&setTimeout((()=>Y({id:s})),o)},z=t=>Z({text:t,level:"info"});z.add=Z,z.hide=Y,z.LEVELS=q,q.forEach((t=>z[t]=e=>Z({level:t,text:e})));var G={toast:z,alert:t=>H.alert=t,confirm:t=>H.confirm=t,state:H};const J=()=>{},Q={computed:{toasts:()=>G.state.toasts.filter((t=>!t.hidden)),alert:()=>(t=>{if(t)return"string"==typeof t&&(t={text:t}),t.tagName=t.tagName||"div",t})(G.state.alert),confirm:()=>{G.state.confirm},actions(){const t=this.alert.actions||[{click:this.closeAlert,text:"Ok"}];return t.forEach((t=>t.class=t.class||"btn btn-primary")),t}},methods:{closeAlert(t){const{confirm:e=J,abort:o=J}=this.alert;(t?e:o)(),G.state.alert=null},hideToast:G.toast.hide}},R={class:"toast-list"},W={class:"text"},X={key:0,class:"modal"},tt={key:0,class:"modal-title"},et={class:"modal-body max-w-md w-11/12"},ot={key:1,class:"modal-footer"};Q.render=function(t,e,o,s,r,l){return a(),n(p,null,[d("div",R,[(a(!0),n(p,null,h(l.toasts,(t=>(a(),n("div",{key:t.id,class:`toast -${t.level}`},[d("div",W,m(t.text),1),d("i",{class:"fa fa-close",onClick:e=>l.hideToast(t)},null,8,["onClick"])],2)))),128))]),l.alert?(a(),n("div",X,[d("div",{class:"modal-mask",onClick:e[1]||(e[1]=(...t)=>l.closeAlert&&l.closeAlert(...t))}),(a(),n(f(l.alert.tagName),{class:"modal-content",onClose:l.closeAlert},{default:u((()=>[l.alert.title?(a(),n("h2",tt,[l.alert.icon?(a(),n("i",{key:0,class:`fa fa-${l.alert.icon}`},null,2)):g("",!0),y(" "+m(l.alert.title),1)])):g("",!0),d("div",et,[l.alert.icon&&!l.alert.title?(a(),n("i",{key:0,class:`fa fa-${l.alert.icon}`},null,2)):g("",!0),y(" "+m(l.alert.text),1)]),l.actions.length?(a(),n("div",ot,[(a(!0),n(p,null,h(l.actions,((t,e)=>(a(),n("button",{key:e,class:t.class,onClick:t.click},m(t.text),11,["onClick"])))),128))])):g("",!0)])),_:1},8,["onClose"]))])):g("",!0)],64)},G.Component=Q;var st=((t,l)=>{for(var a in l||(l={}))o.call(l,a)&&r(t,a,l[a]);if(e)for(var a of e(l))s.call(l,a)&&r(t,a,l[a]);return t})({install(t){t.config.globalProperties.$ui=G,t.component("UnrestUi",Q)}},G);const rt="data-vue-router-controlled";var lt={Popper:w,Dropdown:x,Modal:S,SchemaForm:I,FocusMixin:_,ui:st,applyMeta:(t,e,o)=>{const s=t.matched.slice().reverse().find((t=>{var e;return null==(e=t.meta)?void 0:e.title}));s&&(document.title=s.meta.title);const r=t.matched.slice().reverse().find((t=>{var e;return null==(e=t.meta)?void 0:e.metaTags}));Array.from(document.querySelectorAll(`[${rt}]`)).forEach((t=>t.parentNode.removeChild(t))),null==r||r.meta.tags.forEach((t=>{const e=document.createElement("meta");Object.keys(t).forEach((o=>e.setAttribute(o,t[o]))),e.setAttribute(rt,""),document.head.appendChild(e)})),o()},loadViews:t=>Object.entries(t).map((([t,e])=>{const o={name:t.toLowerCase(),path:`/${t.toLowerCase()}`,component:e,meta:{}};return Object.assign(o,e.__route),o.meta.title||(o.meta.title=t.replace(/[A-Z]/g,(t=>` ${t}`))),o})),plugin:{install(t){t.component("UnrestPopper",w),t.component("UnrestDropdown",x),t.component("UnrestModal",S),t.component("UnrestSchemaForm",I)}}};export default lt;
